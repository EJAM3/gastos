<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Premium Finance Pro</title>
    <style>
        :root {
            --bg: #f4f7f6;
            --accent: #2c3e50;
            --text: #1a1a1a;
            --card-bg: #ffffff;
            --shadow: rgba(0,0,0,0.1);
            --danger: #e74c3c;
            --warning: #f1c40f;
            --success: #2ecc71;
        }

        /* Modo Ella */
        body.pink {
            --bg: #fff5f6;
            --accent: #d4a5a5;
            --text: #4a4a4a;
            --card-bg: #ffffff;
            --shadow: rgba(212, 165, 165, 0.3);
        }

        body { 
            background-color: var(--bg); 
            font-family: '-apple-system', 'Helvetica Neue', sans-serif; 
            margin: 0; color: var(--text); 
            transition: all 0.4s ease;
            padding-bottom: 50px;
        }

        header {
            padding: 60px 25px 30px;
            background: var(--card-bg);
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            box-shadow: 0 10px 30px var(--shadow);
            text-align: center;
        }

        .user-profile {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;
        }

        .mode-toggle {
            background: var(--bg); border: none; padding: 10px 15px; border-radius: 20px;
            font-size: 0.8rem; font-weight: bold; color: var(--accent); box-shadow: 4px 4px 8px var(--shadow);
        }

        .budget-card {
            background: var(--accent); color: white; padding: 25px; border-radius: 30px;
            margin: -50px 20px 20px; box-shadow: 0 15px 35px var(--shadow);
            position: relative; overflow: hidden;
        }

        .budget-progress {
            width: 100%; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; margin-top: 15px;
        }

        .progress-bar {
            height: 100%; width: 0%; background: var(--success); border-radius: 4px; transition: 0.5s;
        }

        .alarm-active { animation: pulse-red 1s infinite; }
        @keyframes pulse-red { 
            0% { background: var(--danger); } 
            50% { background: #ff6b6b; } 
            100% { background: var(--danger); }
        }

        nav {
            display: flex; justify-content: center; gap: 20px; margin: 20px 0;
        }

        nav span {
            padding: 10px 20px; border-radius: 15px; font-weight: 600; font-size: 0.9rem;
            color: #95a5a6; transition: 0.3s;
        }

        nav span.active { background: var(--card-bg); color: var(--accent); box-shadow: 5px 5px 15px var(--shadow); }

        .page { display: none; padding: 0 20px; animation: fadeIn 0.4s; }
        .page.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .input-group {
            background: var(--card-bg); padding: 25px; border-radius: 30px; box-shadow: 0 10px 25px var(--shadow);
        }

        input {
            width: 100%; padding: 15px; border: 1px solid #eee; border-radius: 15px;
            margin-bottom: 15px; font-size: 1rem; box-sizing: border-box; outline: none;
        }

        button.main-btn {
            width: 100%; padding: 18px; border-radius: 15px; border: none;
            background: var(--accent); color: white; font-weight: bold; font-size: 1rem;
            box-shadow: 0 10px 20px var(--shadow);
        }

        .transaction-item {
            background: var(--card-bg); padding: 15px 20px; border-radius: 20px;
            margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 5px 15px var(--shadow);
        }

        #toast {
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%);
            padding: 15px 30px; border-radius: 25px; color: white; font-weight: bold;
            display: none; z-index: 1000; box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="pink"> <div id="toast"></div>

    <header>
        <div class="user-profile">
            <h2 id="userName" onclick="changeName()" style="margin:0">Hola, Usuario ‚ñæ</h2>
            <button class="mode-toggle" onclick="toggleMode()">üîÑ Cambiar Estilo</button>
        </div>
        <div style="font-size: 0.8rem; color: #95a5a6;">INGRESOS DISPONIBLES</div>
        <h1 id="totalIngresos" onclick="setBudget()" style="margin: 5px 0 20px; font-size: 2.5rem;">$0.00</h1>
    </header>

    <div class="budget-card" id="mainCard">
        <div style="display: flex; justify-content: space-between; align-items: flex-end;">
            <div>
                <div style="font-size: 0.7rem; opacity: 0.8;">GASTO ACTUAL</div>
                <div style="font-size: 1.8rem; font-weight: bold;" id="displayTotalGasto">$0.00</div>
            </div>
            <div id="porcentajeText" style="font-size: 0.9rem; font-weight: bold;">0%</div>
        </div>
        <div class="budget-progress">
            <div class="progress-bar" id="bar"></div>
        </div>
        <div id="alarmLabel" style="font-size: 0.6rem; margin-top: 8px; text-align: right; display: none;">‚ö†Ô∏è L√çMITE EXCEDIDO</div>
    </div>

    <nav>
        <span id="t1" class="active" onclick="showPage(1)">ANOTAR</span>
        <span id="t2" onclick="showPage(2)">HISTORIAL</span>
    </nav>

    <div id="page1" class="page active">
        <div class="input-group">
            <input type="text" id="item" placeholder="¬øEn qu√© gastaste?">
            <input type="number" id="price" placeholder="Monto $" inputmode="decimal">
            <button class="main-btn" onclick="agregarGasto()">Guardar Movimiento</button>
        </div>
    </div>

    <div id="page2" class="page">
        <div id="listaTransacciones"></div>
        <button class="main-btn" style="margin-top: 20px; background: #3498db;" onclick="exportarASheets()">üöÄ Sincronizar con Google</button>
        <button onclick="limpiar()" style="width:100%; background:none; border:none; color:#e74c3c; margin-top:30px; font-size:0.7rem;">BORRAR DATOS LOCALES</button>
    </div>

    <script>
        // CONFIGURACI√ìN
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbz8c_aLEXO6wVgb4kVOKaokrqeETvJa7RefjCD4pntVAb60APUFHuIdR8MMBbeR_brZIg/exec";
        
        let db = JSON.parse(localStorage.getItem('pro_finance_v1')) || {
            name: "Usuario",
            mode: "pink",
            ingresos: 0,
            gastos: []
        };

        function init() {
            document.body.className = db.mode;
            document.getElementById('userName').innerText = "Hola, " + db.name + " ‚ñæ";
            document.getElementById('totalIngresos').innerText = "$" + db.ingresos.toFixed(2);
            actualizarUI();
        }

        function toggleMode() {
            db.mode = (db.mode === "pink") ? "" : "pink";
            save();
            document.body.className = db.mode;
        }

        function changeName() {
            let n = prompt("¬øC√≥mo te llamas?", db.name);
            if(n) { db.name = n; save(); init(); }
        }

        function setBudget() {
            let b = prompt("Introduce tus ingresos o presupuesto mensual:", db.ingresos);
            if(b) { db.ingresos = parseFloat(b); save(); init(); }
        }

        function agregarGasto() {
            const item = document.getElementById('item');
            const price = document.getElementById('price');
            if(!item.value || !price.value) return notify("‚ö†Ô∏è Completa los campos", "#e67e22");

            const g = {
                id: Date.now(),
                fecha: new Date().toLocaleDateString('es-ES'),
                nombre: item.value,
                costo: parseFloat(price.value).toFixed(2)
            };

            db.gastos.unshift(g);
            save();
            actualizarUI();
            notify("‚úÖ Guardado localmente", "#2ecc71");
            item.value = ""; price.value = "";
            item.blur(); price.blur();
        }

        function actualizarUI() {
            const totalGasto = db.gastos.reduce((sum, g) => sum + parseFloat(g.costo), 0);
            document.getElementById('displayTotalGasto').innerText = "$" + totalGasto.toFixed(2);
            
            // L√≥gica de Alarma
            const bar = document.getElementById('bar');
            const card = document.getElementById('mainCard');
            const alarmLabel = document.getElementById('alarmLabel');
            let porcentaje = (db.ingresos > 0) ? (totalGasto / db.ingresos) * 100 : 0;
            
            bar.style.width = Math.min(porcentaje, 100) + "%";
            document.getElementById('porcentajeText').innerText = Math.round(porcentaje) + "%";

            if (porcentaje >= 100) {
                bar.style.backgroundColor = "#e74c3c";
                card.classList.add('alarm-active');
                alarmLabel.style.display = "block";
            } else if (porcentaje >= 80) {
                bar.style.backgroundColor = "#f1c40f";
                card.classList.remove('alarm-active');
                alarmLabel.style.display = "none";
            } else {
                bar.style.backgroundColor = "#2ecc71";
                card.classList.remove('alarm-active');
                alarmLabel.style.display = "none";
            }

            // Render Lista
            const container = document.getElementById('listaTransacciones');
            container.innerHTML = db.gastos.map(g => `
                <div class="transaction-item">
                    <div>
                        <div style="font-weight:bold">${g.nombre}</div>
                        <div style="font-size:0.7rem; color:#95a5a6">${g.fecha}</div>
                    </div>
                    <div style="font-weight:900; color:var(--danger)">-$${g.costo}</div>
                </div>
            `).join('');
        }

        async function exportarASheets() {
            if(db.gastos.length === 0) return notify("‚ö†Ô∏è Nada que exportar", "#e67e22");
            notify("‚è≥ Sincronizando...", "#3498db");
            try {
                await fetch(WEB_APP_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ gastos: db.gastos }) });
                notify("üöÄ ¬°Sheets Actualizado!", "#2ecc71");
                db.gastos = [];
                save();
                actualizarUI();
            } catch (e) { notify("‚ùå Error de red", "#e74c3c"); }
        }

        function showPage(n) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('nav span').forEach(s => s.classList.remove('active'));
            document.getElementById('page'+n).classList.add('active');
            document.getElementById('t'+n).classList.add('active');
        }

        function notify(m, c) {
            const t = document.getElementById('toast');
            t.innerText = m; t.style.backgroundColor = c;
            t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 3000);
        }

        function save() { localStorage.setItem('pro_finance_v1', JSON.stringify(db)); }
        function limpiar() { if(confirm("¬øBorrar historial local?")) { db.gastos = []; save(); actualizarUI(); } }

        init();
    </script>
</body>
</html>
