<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Finance Elite</title>
    <style>
        :root {
            /* Modo Eliezer (Hombre - Suave) */
            --bg: #f0f4f8;
            --accent: #546e7a;
            --text: #263238;
            --card-bg: #ffffff;
            --shadow: rgba(84, 110, 122, 0.15);
            --danger: #e57373;
            --success: #81c784;
        }

        /* Modo Mary (Dama) */
        body.pink {
            --bg: #fffafa;
            --accent: #d4a5a5;
            --text: #4a4a4a;
            --card-bg: #ffffff;
            --shadow: rgba(212, 165, 165, 0.25);
        }

        body { 
            background-color: var(--bg); 
            font-family: '-apple-system', sans-serif; 
            margin: 0; color: var(--text); 
            transition: all 0.5s ease;
            padding-bottom: 60px;
        }

        header {
            padding: 60px 25px 40px;
            background: var(--card-bg);
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            box-shadow: 0 10px 30px var(--shadow);
            text-align: center;
        }

        .user-info { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .user-name { font-size: 1.5rem; font-weight: 800; color: var(--accent); margin: 0; }

        .mode-selector {
            margin-top: 15px; display: flex; gap: 10px;
        }

        .btn-mode {
            border: none; padding: 8px 15px; border-radius: 20px; font-size: 0.7rem; font-weight: bold;
            background: var(--bg); color: var(--accent); box-shadow: 3px 3px 6px var(--shadow);
        }

        .budget-card {
            background: var(--accent); color: white; padding: 25px; border-radius: 30px;
            margin: -30px 20px 20px; box-shadow: 0 15px 35px var(--shadow);
        }

        .budget-progress {
            width: 100%; height: 6px; background: rgba(255,255,255,0.2); border-radius: 3px; margin-top: 15px;
        }

        .progress-bar { height: 100%; width: 0%; background: var(--success); border-radius: 3px; transition: 0.8s ease-in-out; }

        .alarm-active { animation: pulse-red 1.5s infinite; }
        @keyframes pulse-red { 0% { opacity: 1; } 50% { opacity: 0.7; background: #ff5252; } 100% { opacity: 1; } }

        nav { display: flex; justify-content: center; gap: 15px; margin: 25px 0; }
        nav span { padding: 12px 25px; border-radius: 20px; font-weight: 700; font-size: 0.85rem; color: #90a4ae; transition: 0.3s; }
        nav span.active { background: var(--card-bg); color: var(--accent); box-shadow: 0 5px 15px var(--shadow); }

        .page { display: none; padding: 0 20px; animation: slideUp 0.4s ease-out; }
        .page.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .input-group { background: var(--card-bg); padding: 30px; border-radius: 30px; box-shadow: 0 10px 30px var(--shadow); }
        input { 
            width: 100%; padding: 16px; border: 1px solid rgba(0,0,0,0.05); border-radius: 15px;
            margin-bottom: 15px; font-size: 1rem; box-sizing: border-box; outline: none; background: var(--bg);
        }

        .main-btn {
            width: 100%; padding: 18px; border-radius: 15px; border: none;
            background: var(--accent); color: white; font-weight: 800; font-size: 0.9rem;
            box-shadow: 0 8px 20px var(--shadow); letter-spacing: 1px;
        }

        .transaction-item {
            background: var(--card-bg); padding: 18px 22px; border-radius: 22px;
            margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 12px var(--shadow);
        }

        #toast {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            padding: 12px 25px; border-radius: 20px; color: white; font-weight: bold;
            display: none; z-index: 1000; font-size: 0.8rem;
        }
    </style>
</head>
<body class="pink">

    <div id="toast"></div>

    <header>
        <div class="user-info">
            <p style="margin:0; font-size: 0.7rem; letter-spacing: 2px; opacity: 0.6;">BIENVENIDO</p>
            <h2 class="user-name" id="userName">Mary</h2>
            <div class="mode-selector">
                <button class="btn-mode" onclick="setMode('pink', 'Mary')">ðŸŒ¸ MODO MARY</button>
                <button class="btn-mode" onclick="setMode('', 'Eliezer')">ðŸ‘” MODO ELIEZER</button>
            </div>
        </div>
        <div style="margin-top: 25px; font-size: 0.7rem; color: #90a4ae; font-weight: 700;">PRESUPUESTO MENSUAL</div>
        <h1 id="totalIngresos" onclick="setBudget()" style="margin: 5px 0 0; font-size: 2.2rem; font-weight: 900;">$0.00</h1>
    </header>

    <div class="budget-card" id="mainCard">
        <div style="display: flex; justify-content: space-between; align-items: flex-end;">
            <div>
                <div style="font-size: 0.65rem; font-weight: 700; opacity: 0.8; letter-spacing: 1px;">GASTO TOTAL</div>
                <div style="font-size: 1.6rem; font-weight: 900;" id="displayTotalGasto">$0.00</div>
            </div>
            <div id="porcentajeText" style="font-size: 0.9rem; font-weight: 800;">0%</div>
        </div>
        <div class="budget-progress">
            <div class="progress-bar" id="bar"></div>
        </div>
    </div>

    <nav>
        <span id="t1" class="active" onclick="showPage(1)">NUEVO</span>
        <span id="t2" onclick="showPage(2)">HISTORIAL</span>
    </nav>

    <div id="page1" class="page active">
        <div class="input-group">
            <input type="text" id="item" placeholder="Â¿En quÃ© gastaste hoy?">
            <input type="number" id="price" placeholder="Monto $" inputmode="decimal">
            <button class="main-btn" onclick="agregarGasto()">REGISTRAR GASTO</button>
        </div>
    </div>

    <div id="page2" class="page">
        <div id="listaTransacciones"></div>
        <button class="main-btn" style="margin-top: 20px; background: #3498db;" onclick="exportarASheets()">ðŸš€ SINCRONIZAR SHEETS</button>
        <button onclick="limpiar()" style="width:100%; background:none; border:none; color:#e57373; margin-top:30px; font-size:0.6rem; font-weight:bold; letter-spacing:1px;">BORRAR MEMORIA LOCAL</button>
    </div>

    <script>
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbz8c_aLEXO6wVgb4kVOKaokrqeETvJa7RefjCD4pntVAb60APUFHuIdR8MMBbeR_brZIg/exec";
        
        let db = JSON.parse(localStorage.getItem('pro_finance_v2')) || {
            name: "Mary",
            mode: "pink",
            ingresos: 0,
            gastos: []
        };

        function init() {
            document.body.className = db.mode;
            document.getElementById('userName').innerText = db.name;
            document.getElementById('totalIngresos').innerText = "$" + db.ingresos.toFixed(2);
            actualizarUI();
        }

        function setMode(modeClass, name) {
            db.mode = modeClass;
            db.name = name;
            save();
            init();
            notify("Cambiado a modo " + name, "#546e7a");
        }

        function setBudget() {
            let b = prompt("Presupuesto disponible:", db.ingresos);
            if(b !== null) { db.ingresos = parseFloat(b) || 0; save(); init(); }
        }

        function agregarGasto() {
            const item = document.getElementById('item');
            const price = document.getElementById('price');
            if(!item.value || !price.value) return notify("âš ï¸ Datos incompletos", "#ff8a80");

            db.gastos.unshift({
                id: Date.now(),
                fecha: new Date().toLocaleDateString('es-ES'),
                nombre: item.value,
                costo: parseFloat(price.value).toFixed(2)
            });

            save();
            actualizarUI();
            notify("âœ… Guardado", "#81c784");
            item.value = ""; price.value = "";
            item.blur(); price.blur();
        }

        function actualizarUI() {
            const totalGasto = db.gastos.reduce((sum, g) => sum + parseFloat(g.costo), 0);
            document.getElementById('displayTotalGasto').innerText = "$" + totalGasto.toFixed(2);
            
            const bar = document.getElementById('bar');
            const card = document.getElementById('mainCard');
            let porcentaje = (db.ingresos > 0) ? (totalGasto / db.ingresos) * 100 : 0;
            
            bar.style.width = Math.min(porcentaje, 100) + "%";
            document.getElementById('porcentajeText').innerText = Math.round(porcentaje) + "%";

            if (porcentaje >= 100) {
                bar.style.backgroundColor = "#e57373";
                card.classList.add('alarm-active');
            } else {
                bar.style.backgroundColor = (porcentaje >= 80) ? "#ffd54f" : "#81c784";
                card.classList.remove('alarm-active');
            }

            document.getElementById('listaTransacciones').innerHTML = db.gastos.map(g => `
                <div class="transaction-item">
                    <div>
                        <div style="font-weight:800; font-size:0.9rem">${g.nombre}</div>
                        <div style="font-size:0.65rem; color:#90a4ae">${g.fecha}</div>
                    </div>
                    <div style="font-weight:900; color:#e57373">-$${g.costo}</div>
                </div>
            `).join('');
        }

        async function exportarASheets() {
            if(db.gastos.length === 0) return notify("âš ï¸ No hay gastos", "#ff8a80");
            notify("â³ Sincronizando...", "#3498db");
            try {
                await fetch(WEB_APP_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ gastos: db.gastos }) });
                notify("ðŸš€ Â¡Enviado a Google Sheets!", "#81c784");
                db.gastos = []; save(); actualizarUI();
            } catch (e) { notify("âŒ Error de red", "#e57373"); }
        }

        function showPage(n) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('nav span').forEach(s => s.classList.remove('active'));
            document.getElementById('page'+n).classList.add('active');
            document.getElementById('t'+n).classList.add('active');
        }

        function notify(m, c) {
            const t = document.getElementById('toast');
            t.innerText = m; t.style.backgroundColor = c;
            t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 3000);
        }

        function save() { localStorage.setItem('pro_finance_v2', JSON.stringify(db)); }
        function limpiar() { if(confirm("Â¿Borrar datos locales?")) { db.gastos = []; save(); actualizarUI(); } }

        init();
    </script>
</body>
</html>
